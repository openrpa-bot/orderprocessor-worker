version: '3.8'

services:
  temporal-worker:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: orderprocessor-worker
    environment:
      # Temporal Configuration
      - TEMPORAL_HOST=${TEMPORAL_HOST:-192.168.1.112:7233}
      
      # Redis Configuration
      - REDIS_HOST=${REDIS_HOST:-localhost}
      - REDIS_PORT=${REDIS_PORT:-6379}
      - REDIS_PASSWORD=${REDIS_PASSWORD:-}
      
      # Database Configuration (PostgreSQL/Citus)
      - DB_HOST=${DB_HOST:-localhost}
      - DB_PORT=${DB_PORT:-5432}
      - DB_NAME=${DB_NAME:-pgdb}
      - DB_USER=${DB_USER:-pguser}
      - DB_PASSWORD=${DB_PASSWORD:-pgpass}
      
      # LTP Scheduler Configuration
      # Schedule times in 24-hour format (HH:mm)
      # Default: 09:07 to 15:30 (9:07 AM to 3:30 PM)
      - SCHEDULE_START_TIME=${SCHEDULE_START_TIME:-09:07}
      - SCHEDULE_END_TIME=${SCHEDULE_END_TIME:-15:30}
      - SCHEDULE_INTERVAL_MINUTES=${SCHEDULE_INTERVAL_MINUTES:-1}
    volumes:
      - ./env.example:/app/.env:ro
    restart: unless-stopped
    networks:
      - temporal-network

  # Optional: Redis service (if not using external Redis)
  # redis:
  #   image: redis:7-alpine
  #   container_name: redis
  #   ports:
  #     - "6379:6379"
  #   volumes:
  #     - redis-data:/data
  #   networks:
  #     - temporal-network

  # Optional: PostgreSQL/Citus service (if not using external database)
  # postgres:
  #   image: citusdata/citus:latest
  #   container_name: citus
  #   environment:
  #     - POSTGRES_PASSWORD=${DB_PASSWORD:-pgpass}
  #     - POSTGRES_USER=${DB_USER:-pguser}
  #     - POSTGRES_DB=${DB_NAME:-pgdb}
  #   ports:
  #     - "5432:5432"
  #   volumes:
  #     - postgres-data:/var/lib/postgresql/data
  #   networks:
  #     - temporal-network

networks:
  temporal-network:
    driver: bridge

# volumes:
#   redis-data:
#   postgres-data:
